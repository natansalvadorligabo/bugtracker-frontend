<div class="h-screen w-auto">
  <div class="bg-gray-100 min-h-screen">
    <div class="px-15 py-6">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <div class="flex items-center gap-4">
          <h1 class="text-2xl font-bold text-gray-900">Tickets</h1>
          <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm font-medium">
            {{ tickets.length }} {{ tickets.length === 1 ? 'ticket' : 'tickets' }}
          </span>
        </div>

        <button
          class="flex items-center gap-3 px-4 py-3 bg-gradient-to-r from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100 border-2 border-blue-200 hover:border-blue-300 rounded-lg transition-all duration-200 active:scale-95 shadow-sm hover:shadow-md"
          (click)="toggleTicketView()"
          [attr.aria-label]="'Alternar para ' + (showOnlyMyTickets ? 'todos os tickets' : 'meus tickets')"
        >
          <div class="flex items-center gap-2">
            <mat-icon class="text-xl text-blue-600">{{ showOnlyMyTickets ? 'person' : 'groups' }}</mat-icon>
            <div class="flex flex-col items-start">
              <span class="text-sm font-semibold text-blue-800">{{ currentViewLabel }}</span>
              <span class="text-xs text-blue-600">{{ showOnlyMyTickets ? 'Clique para ver todos' : 'Clique para ver apenas seus' }}</span>
            </div>
          </div>
          <mat-icon class="text-blue-500 text-base">swap_horiz</mat-icon>
        </button>
      </div>

      <div class="mt-3 flex items-center gap-2">
        <div
          class="flex items-center gap-2 px-3 py-1 rounded-full"
          [class]="showOnlyMyTickets ? 'bg-green-100 text-green-700' : 'bg-purple-100 text-purple-700'"
        >
          <div
            class="w-2 h-2 rounded-full"
            [class]="showOnlyMyTickets ? 'bg-green-500' : 'bg-purple-500'"
          ></div>
          <span class="text-sm font-medium">
            {{ showOnlyMyTickets ? 'Visualizando apenas seus tickets' : 'Visualizando todos os tickets do sistema' }}
          </span>
        </div>
      </div>
    </div>

    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-8 px-15 mb-6 mt-6">
      <mat-form-field
        class="flex-1"
        appearance="outline"
      >
        <mat-label>Buscar por título</mat-label>
        <input
          matInput
          placeholder="Digite o nome do card..."
          [(ngModel)]="searchTerm"
          type="text"
        />
        @if (searchTerm) {
        <button
          matSuffix
          mat-icon-button
          aria-label="Limpar busca"
          (click)="clearSearch()"
          type="button"
        >
          <mat-icon>close</mat-icon>
        </button>
        }
      </mat-form-field>
    </div>

    <div class="px-15 mb-6 sm:mb-15 md:mb-15">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title class="text-sm sm:text-base">
            <mat-icon class="mr-1 sm:mr-2">filter_list</mat-icon>
            <span class="hidden lg:inline">Filtros</span>
            <span class="lg:hidden">Filtros</span>
          </mat-panel-title>
          <mat-panel-description class="text-xs sm:text-sm">
            <span class="hidden lg:inline">Filtrar por tags e status</span>
            <span class="sm:hidden">Filtrar cards</span>
            @if (selectedTags.length > 0 || selectedStatuses.length > 0) {
            <span class="ml-1 sm:ml-2">({{ selectedTags.length + selectedStatuses.length }})</span>
            }
          </mat-panel-description>
        </mat-expansion-panel-header>

        <div class="mb-4">
          <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
            <mat-icon class="mr-1 text-base">local_offer</mat-icon>
            Tags
          </h4>
          <div class="flex flex-wrap gap-1 sm:gap-2 p-2 sm:p-0">
            <mat-chip-set>
              @for (tag of availableTags; track tag.ticketCategoryId) {
              <mat-chip-option
                (click)="toggleTag(tag)"
                [selected]="isTagSelected(tag)"
                [value]="tag"
                class="text-xs sm:text-sm"
              >
                {{ tag.description }}
              </mat-chip-option>
              }
            </mat-chip-set>
          </div>
        </div>

        <div class="mb-4">
          <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
            <mat-icon class="mr-1 text-base">assignment</mat-icon>
            Status
          </h4>
          <div class="flex flex-wrap gap-1 sm:gap-2 p-2 sm:p-0">
            <mat-chip-set>
              @for (status of availableStatuses; track status.value) {
              <mat-chip-option
                (click)="toggleStatus(status.value)"
                [selected]="isStatusSelected(status.value)"
                [value]="status.value"
                class="text-xs sm:text-sm"
              >
                <span [class]="status.color">{{ status.label }}</span>
              </mat-chip-option>
              }
            </mat-chip-set>
          </div>
        </div>

        @if (selectedTags.length > 0 || selectedStatuses.length > 0) {
        <mat-action-row class="px-2 sm:px-0">
          @if (selectedTags.length > 0) {
          <button
            mat-button
            (click)="clearTags()"
            color="warn"
            class="text-xs sm:text-sm mr-2"
          >
            <mat-icon class="text-base sm:text-lg">local_offer_off</mat-icon>
            <span class="hidden sm:inline ml-1">Limpar tags</span>
            <span class="sm:hidden ml-1">Tags</span>
          </button>
          } @if (selectedStatuses.length > 0) {
          <button
            mat-button
            (click)="clearStatuses()"
            color="warn"
            class="text-xs sm:text-sm mr-2"
          >
            <mat-icon class="text-base sm:text-lg">assignment_turned_in</mat-icon>
            <span class="hidden sm:inline ml-1">Limpar status</span>
            <span class="sm:hidden ml-1">Status</span>
          </button>
          }

          <button
            mat-button
            (click)="clearFilters()"
            color="warn"
            class="text-xs sm:text-sm"
          >
            <mat-icon class="text-base sm:text-lg">clear_all</mat-icon>
            <span class="hidden sm:inline ml-1">Limpar tudo</span>
            <span class="sm:hidden ml-1">Tudo</span>
          </button>
        </mat-action-row>
        }
      </mat-expansion-panel>
    </div>

    @if (isLoading) {
    <div class="flex justify-center items-center py-20">
      <div class="text-center flex flex-col items-center">
        <mat-progress-spinner
          diameter="60"
          mode="indeterminate"
          color="primary"
        ></mat-progress-spinner>
        <p class="text-gray-600 mt-4">Carregando tickets...</p>
      </div>
    </div>
    } @if (!isLoading) {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 px-15 pb-6">
      @for (ticket of tickets; track ticket.ticketId) {
      <div
        class="bg-white rounded-xl cursor-pointer shadow-sm transition-shadow p-6 min-h-[190px] flex flex-col relative"
        (click)="viewTicket(ticket.ticketId)"
      >
        <div class="absolute top-3 right-3">
          <span
            class="px-2 py-1 rounded-full text-xs font-medium border"
            [class]="getStatusInfo(ticket.ticketStatus).color"
            [ngClass]="{
                  'bg-yellow-50 border-yellow-200': ticket.ticketStatus === 'PENDING',
                  'bg-orange-50 border-orange-200': ticket.ticketStatus === 'ATTACHED',
                  'bg-red-50 border-red-200': ticket.ticketStatus === 'STOPPED',
                  'bg-green-50 border-green-200': ticket.ticketStatus === 'COMPLETED',
                  'bg-gray-50 border-gray-200': !['PENDING', 'ATTACHED', 'STOPPED', 'COMPLETED'].includes(ticket.ticketStatus)
                }"
          >
            {{ getStatusInfo(ticket.ticketStatus).label }}
          </span>
        </div>

        <h3 class="text-lg mb-4 pr-20">{{ ticket.title || 'Sem título' }}</h3>
        <p class="text-gray-600 line-clamp-3">{{ ticket.description }}</p>
        <div class="flex flex-wrap gap-2 mt-auto">
          @for (tag of getTagsForticket(ticket); track tag.ticketCategoryId) {
          <span class="px-3 py-1 bg-gray-200 text-gray-700 rounded-full text-sm">{{ tag.description }}</span>
          }
        </div>
      </div>
      }
    </div>
    } @if (!isLoading && hasNoResults && !isSearching && !isFiltering) {
    <div class="flex flex-col items-center justify-center py-16 px-15">
      <mat-card class="text-center">
        <mat-card-content>
          <mat-icon
            class="text-6xl text-gray-300 mb-4"
            style="font-size: 4rem; width: 4rem; height: 4rem"
          >
            assignment
          </mat-icon>
          <h3 class="text-xl font-semibold text-gray-600 mb-2">
            @if (showOnlyMyTickets) {
            <span>Você não possui tickets no momento!</span>
            } @if (!showOnlyMyTickets) {
            <span>Não há tickets cadastrados no sistema!</span>
            }
          </h3>
          <p class="text-gray-500">
            @if (showOnlyMyTickets) {
            <span>Quando você criar suas primeiras tickets, elas aparecerão aqui.</span>
            } @if (!showOnlyMyTickets) {
            <span>Quando alguém criar tickets no sistema, eles aparecerão aqui.</span>
            }
          </p>
        </mat-card-content>
      </mat-card>
    </div>
    } @if (!isLoading && hasNoResults && (isSearching || isFiltering)) {
    <div class="flex flex-col items-center justify-center py-10 px-15">
      <mat-card class="text-center">
        <mat-card-content>
          <mat-icon
            class="text-6xl text-gray-300 mb-4"
            style="font-size: 4rem; width: 4rem; height: 4rem"
          >
            search_off
          </mat-icon>
          <h3 class="text-xl font-semibold text-gray-600 mb-2">
            @if (isSearching && !isFiltering) {
            <span>Você não possui tickets com esse título!</span>
            } @if (!isSearching && isFiltering) {
            <span>Nenhum ticket encontrado com esses filtros!</span>
            } @if (isSearching && isFiltering) {
            <span>Nenhum ticket encontrado com esses critérios!</span>
            }
          </h3>
          <p class="text-gray-500 mb-4">Tente ajustar os filtros ou limpe-os para ver todos os tickets.</p>

          <div class="flex flex-col sm:flex-row gap-3 justify-center">
            @if (isSearching) {
            <button
              mat-stroked-button
              (click)="clearSearch()"
            >
              <mat-icon>clear</mat-icon>
              Limpar busca
            </button>
            } @if (selectedTags.length > 0) {
            <button
              mat-stroked-button
              (click)="clearTags()"
            >
              <mat-icon>local_offer_off</mat-icon>
              Limpar tags
            </button>
            } @if (selectedStatuses.length > 0) {
            <button
              mat-stroked-button
              (click)="clearStatuses()"
            >
              <mat-icon>assignment_turned_in</mat-icon>
              Limpar status
            </button>
            } @if ((isSearching && isFiltering) || (selectedTags.length > 0 && selectedStatuses.length > 0)) {
            <button
              mat-stroked-button
              (click)="clearFilters()"
            >
              <mat-icon>clear_all</mat-icon>
              Limpar tudo
            </button>
            }
          </div>
        </mat-card-content>
      </mat-card>
    </div>
    }
  </div>
</div>
